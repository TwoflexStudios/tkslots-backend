<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <html lang="pt-br">
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
    <script src="{{thisUrl}}/game/bonus.js"></script>
    <script src="{{thisUrl}}/game/bridge.js"></script>
    <script src="{{thisUrl}}/game/tk_create_runtime_bridge.js"></script>
    <script src="{{thisUrl}}/game/tk_extends_runtime_bridge.js"></script>
    <link rel="stylesheet" href="{{thisUrl}}/game/styles.css">
    <title>TK Manager Game Host</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #GameDiv {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
    </style>

</head>

<body>
    <div id="GameDiv">
        <canvas id="GameCanvas" tabIndex="99"></canvas>
    </div>


    <div id="splash">
        <div class="progress-bar stripes">
            <span style="width: 0%"></span>
        </div>
    </div>
    <!-- Modal -->
    <div id="bypassModal" style="display:none;">
        <div class="title">Aplicando Bypass</div>
        <div id="countdownTimer">00:00</div>
        <button id="cancelButton">Cancelar</button>
        <div class="progress-wrapper">
            <div id="progressBar"></div>
        </div>
    </div>


    <script>
        window.tk = {};
        {{game_data}}
    </script>

    <script type="text/javascript">
        (function () {
            var userAgent = navigator.userAgent.toLowerCase();
            // isMobile
            var isMobile = false; // /mobile|android|iphone|ipad|phone/i.test(userAgent);
            var gameDiv = document.getElementById('GameDiv');
            var body = document.getElementsByTagName('body')[0];
            let orientation = 2 // 1:portrait 2:landscape
            let isLobby = true
            //pc browser
            if (!isMobile) {
                function setGameDiv() {
                    var clientWidth = document.documentElement.clientWidth;
                    var clientHeight = document.documentElement.clientHeight;
                    var gameWidth;
                    var gameHeight;


                    if (isLobby) // lobby full screen
                    {
                        gameWidth = clientWidth + 'px'
                        gameHeight = clientHeight + 'px'
                    }
                    else //game
                    {
                        if (orientation == 1) //portrait
                        {
                            var widthRatio = clientWidth / 750;
                            var heightRatio = clientHeight / 1334;
                            gameWidth = false ? '100%' : 750 * heightRatio;
                            gameHeight = false ? 1334 * widthRatio : '100%';
                            if (gameWidth != '100%') {
                                gameWidth += 'px';
                            }
                            if (gameHeight != '100%') {
                                gameHeight += 'px';
                            }
                        }
                        else //landscape
                        {
                            gameWidth = clientWidth + 'px'
                            gameHeight = clientHeight + 'px'
                        }

                    }

                    gameDiv.style.width = gameWidth
                    gameDiv.style.height = gameHeight
                    body.style.alignItems = 'center';
                    body.style.justifyContent = 'center';
                }
                setGameDiv();
                window.onresize = function () {
                    setGameDiv();
                }
                //change canvas size
                window.addEventListener('changeCanvasSize', (event) => {
                    orientation = event.detail.orientation;
                    isLobby = event.detail.isLobby;
                });
            }
        })();
    </script>

    <!-- Ordem exata do HTML original do Cocos -->
    <script src="{{thisUrl}}/game/src/polyfills.bundle.5adbf.js"></script>
    <script src="{{thisUrl}}/game/src/system.bundle.543e6.js"></script>
    <script src="{{thisUrl}}/game/src/import-map.c5050.json" type="systemjs-importmap"></script>

    <script>
        try {
            localStorage.clear();
        } catch (ex) { }
        System.import('{{thisUrl}}/game/index.382b2.js')
            .catch(err => console.error(err));
    </script>

</body>

</html>